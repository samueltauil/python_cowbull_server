pipeline {
    agent any

    stages {

      stage('Build - Dev') {
        openshift.withCluster() {
          openshift.withProject("cowbull-dev") {
             def cbbc = openshift.selector('bc',"cowbull-server")
             def buildSelector = cbbc.startBuild()
             buildSelector.logs('-f')
          }
       }
      }

      stage ('Promote to QA') {
        mail (
            to: 'samueltauil@gmail.com',
            subject: "CowBull Server (${env.BUILD_NUMBER}) is awaiting promotion",
             body: "Please go to ${env.BUILD_URL}.");
        input "Do you want to promote to QA ?"
      }

      stage ('Deploy - QA') {
         openshift.withCluster() {
            openshift.withProject("cowbull-dev") {
               openshift.tag("cowbull-dev/cowbull-server:latest", "cowbull-dev/cowbull-server:promote-qa")
               openshift.newApp("cowbull-dev/cowbull-server:promote-qa")
            }
         }
      }
    }
}
